[{"categories":["linux source"],"content":"pre-work for reading the source code of the linux","date":"2022-06-21","objectID":"/p/2022/06/linux-start/","tags":["linux","source"],"title":"Linux Start","uri":"/p/2022/06/linux-start/"},{"categories":["jdk"],"content":"Concurrency ","date":"2022-05-24","objectID":"/p/2022/05/jdk-concurrency/:0:0","tags":["jdk","java"],"title":"Jdk Concurrency","uri":"/p/2022/05/jdk-concurrency/"},{"categories":["jdk"],"content":"conception concurrent(concurrency) when two or more tasks can start, run, and complete in overlapping time periods. It doesn’t necessarily mean they’ll ever both be running at the same instant parallel(parallelism) when tasks literally run at the same time, e.g., on a multicore processor. cache line size /proc/cpuinfo cache_alignment : 64 byte ","date":"2022-05-24","objectID":"/p/2022/05/jdk-concurrency/:1:0","tags":["jdk","java"],"title":"Jdk Concurrency","uri":"/p/2022/05/jdk-concurrency/"},{"categories":["jdk"],"content":"Feature bug source visibility, orderliness, atomicity ","date":"2022-05-24","objectID":"/p/2022/05/jdk-concurrency/:2:0","tags":["jdk","java"],"title":"Jdk Concurrency","uri":"/p/2022/05/jdk-concurrency/"},{"categories":["jdk"],"content":"visibility volatile memory fence synchronized Lock final ","date":"2022-05-24","objectID":"/p/2022/05/jdk-concurrency/:2:1","tags":["jdk","java"],"title":"Jdk Concurrency","uri":"/p/2022/05/jdk-concurrency/"},{"categories":["jdk"],"content":"orderliness volatile memory fence synchronized Lock ","date":"2022-05-24","objectID":"/p/2022/05/jdk-concurrency/:2:2","tags":["jdk","java"],"title":"Jdk Concurrency","uri":"/p/2022/05/jdk-concurrency/"},{"categories":["jdk"],"content":"atomicity synchronized Lock CAS ","date":"2022-05-24","objectID":"/p/2022/05/jdk-concurrency/:2:3","tags":["jdk","java"],"title":"Jdk Concurrency","uri":"/p/2022/05/jdk-concurrency/"},{"categories":["jdk"],"content":"fundamental principle ","date":"2022-05-24","objectID":"/p/2022/05/jdk-concurrency/:3:0","tags":["jdk","java"],"title":"Jdk Concurrency","uri":"/p/2022/05/jdk-concurrency/"},{"categories":["jdk"],"content":"volatile feature visibility each writing of a variable decorated by volatile can be awared for each thread 对一个volatile变量的读，总是能看到（任意线程）对这个volatile变量最后的写入。 atomicity read/write is a atomic op for variable decorated by volatile 对任意单个volatile变量的读/写具有原子性，但类似于volatile++这种复合操作不具有原子性（基于这点，我们通过会认为volatile不具备原子性）。volatile仅仅保证对单个volatile变量的读/写具有原子性，而锁的互斥执行的特性可以确保对整个临界区代码的执行具有原子性。 64位的long型和double型变量，只要它是volatile变量，对该变量的读/写就具有原子性。 orderliness 对volatile修饰的变量的读写操作前后加上各种特定的内存屏障来禁止指令重排序来保障有序性。 source bytecode // src/hotspot/share/interpreter/zero/bytecodeInterpreter.cpp CASE(_putfield): CASE(_putstatic): { ... if (cache-\u003eis_volatile()) { ... OrderAccess::storeload(); } UPDATE_PC_AND_TOS_AND_CONTINUE(3, count); } // src/hotspot/share/interpreter/zero/bytecodeInterpreter.cpp ... #include \"runtime/orderAccess.hpp\" ... // src/hotspot/share/runtime/orderAccess.hpp class OrderAccess : public AllStatic { public: // barriers static void loadload(); static void storestore(); static void loadstore(); static void storeload(); static void acquire(); static void release(); static void fence(); ... } #include OS_CPU_HEADER(orderAccess) // src/hotspot/os_cpu/linux_x86/orderAccess_linux_x86.hpp inline void OrderAccess::loadload() { compiler_barrier(); } inline void OrderAccess::storestore() { compiler_barrier(); } inline void OrderAccess::loadstore() { compiler_barrier(); } inline void OrderAccess::storeload() { fence(); } inline void OrderAccess::acquire() { compiler_barrier(); } inline void OrderAccess::release() { compiler_barrier(); } inline void OrderAccess::fence() { // always use locked addl since mfence is sometimes expensive #ifdef AMD64 __asm__ volatile (\"lock; addl $0,0(%%rsp)\" : : : \"cc\", \"memory\"); #else __asm__ volatile (\"lock; addl $0,0(%%esp)\" : : : \"cc\", \"memory\"); #endif compiler_barrier(); } template // src/hotspot/share/interpreter/templateInterpreter.cpp void TemplateInterpreter::initialize_code() { AbstractInterpreter::initialize(); TemplateTable::initialize(); ... } // src/hotspot/share/interpreter/templateTable.cpp void TemplateTable::initialize() { ... def(Bytecodes::_getstatic , ubcp|____|clvm|____, vtos, vtos, getstatic , f1_byte ); def(Bytecodes::_putstatic , ubcp|____|clvm|____, vtos, vtos, putstatic , f2_byte ); def(Bytecodes::_getfield , ubcp|____|clvm|____, vtos, vtos, getfield , f1_byte ); def(Bytecodes::_putfield , ubcp|____|clvm|____, vtos, vtos, putfield , f2_byte ); ... } // src/hotspot/cpu/x86/templateTable_x86.cpp void TemplateTable::putfield(int byte_no) { putfield_or_static(byte_no, false); } void TemplateTable::putstatic(int byte_no) { putfield_or_static(byte_no, true); } void TemplateTable::putfield_or_static(int byte_no, bool is_static, RewriteControl rc) { transition(vtos, vtos); const Register cache = rcx; const Register index = rdx; const Register obj = rcx; const Register off = rbx; const Register flags = rax; resolve_cache_and_index(byte_no, cache, index, sizeof(u2)); jvmti_post_field_mod(cache, index, is_static); load_field_cp_cache_entry(obj, cache, index, off, flags, is_static); // [jk] not needed currently // volatile_barrier(Assembler::Membar_mask_bits(Assembler::LoadStore | // Assembler::StoreStore)); Label notVolatile, Done; __ movl(rdx, flags); __ shrl(rdx, ConstantPoolCacheEntry::is_volatile_shift); __ andl(rdx, 0x1); // Check for volatile store __ testl(rdx, rdx); __ jcc(Assembler::zero, notVolatile); putfield_or_static_helper(byte_no, is_static, rc, obj, off, flags); volatile_barrier(Assembler::Membar_mask_bits(Assembler::StoreLoad | Assembler::StoreStore)); __ jmp(Done); __ bind(notVolatile); putfield_or_static_helper(byte_no, is_static, rc, obj, off, flags); __ bind(Done); } void TemplateTable::volatile_barrier(Assembler::Membar_mask_bits order_constraint ) { // Helper function to insert a is-volatile test and memory barrier __ membar(order_constraint); } void Assembler::membar(Membar_mask_bits order_constraint) { // We only have to handle StoreLoad if (order_constraint \u0026 StoreLoad) { // All usabl","date":"2022-05-24","objectID":"/p/2022/05/jdk-concurrency/:3:1","tags":["jdk","java"],"title":"Jdk Concurrency","uri":"/p/2022/05/jdk-concurrency/"},{"categories":["jdk"],"content":"reference What is the difference between concurrency and parallelism? ","date":"2022-05-24","objectID":"/p/2022/05/jdk-concurrency/:4:0","tags":["jdk","java"],"title":"Jdk Concurrency","uri":"/p/2022/05/jdk-concurrency/"},{"categories":["jdk"],"content":"Jdk Start ","date":"2022-05-24","objectID":"/p/2022/05/jdk-start/:0:0","tags":["jdk","java","source"],"title":"Jdk Start","uri":"/p/2022/05/jdk-start/"},{"categories":["jdk"],"content":"Environment 操作系统: Linux yu 5.17.9-arch1-1 #1 SMP PREEMPT Wed, 18 May 2022 17:30:11 +0000 x86_64 GNU/Linux bootjdk: openjdk version “17.0.3” 2022-04-19 jdk源码: jdk17u-jdk-17.0.3-ga 阅读工具: vscode ","date":"2022-05-24","objectID":"/p/2022/05/jdk-start/:1:0","tags":["jdk","java","source"],"title":"Jdk Start","uri":"/p/2022/05/jdk-start/"},{"categories":["jdk"],"content":"Prepration ","date":"2022-05-24","objectID":"/p/2022/05/jdk-start/:2:0","tags":["jdk","java","source"],"title":"Jdk Start","uri":"/p/2022/05/jdk-start/"},{"categories":["jdk"],"content":"Source openjdk https://hg.openjdk.java.net/ GitHub ","date":"2022-05-24","objectID":"/p/2022/05/jdk-start/:2:1","tags":["jdk","java","source"],"title":"Jdk Start","uri":"/p/2022/05/jdk-start/"},{"categories":["jdk"],"content":"Compile compile tools basic tools bear 用于生成compile_commands.json文件 compile # jdk 17 # maybe with --disable-javac-server # clang bash configure --with-conf-name=clang --disable-warnings-as-errors --with-boot-jdk=/usr/lib/jvm/java-17-openjdk --with-toolchain-type=clang bear -- make CONF_NAME=clang # gcc bash configure --with-conf-name=gcc --disable-warnings-as-errors --with-boot-jdk=/usr/lib/jvm/java-17-openjdk --with-toolchain-type=gcc bear -- make CONF_NAME=gcc test build java with ./build/clang/jdk/bin/java --version command output: openjdk version \"17.0.3-internal\" 2022-04-19 OpenJDK Runtime Environment (build 17.0.3-internal+0-adhoc.yu.jdk17u-jdk-17.0.3-ga) OpenJDK 64-Bit Server VM (build 17.0.3-internal+0-adhoc.yu.jdk17u-jdk-17.0.3-ga, mixed mode) ","date":"2022-05-24","objectID":"/p/2022/05/jdk-start/:2:2","tags":["jdk","java","source"],"title":"Jdk Start","uri":"/p/2022/05/jdk-start/"},{"categories":["jdk"],"content":"Tools vscode Plugin clangd Java Extension Pack jps -l 查看java线程 jhsdb sudo jhsdb hsdb 打开ui界面 需要安装Courier Prime 字体 yay -S ttf-courier-prime ","date":"2022-05-24","objectID":"/p/2022/05/jdk-start/:2:3","tags":["jdk","java","source"],"title":"Jdk Start","uri":"/p/2022/05/jdk-start/"},{"categories":["jdk"],"content":"Dir Structure cpu os os_cpu share adlc (Architecture Description Language Compiler) 平台描述文件 aot 汇编器接口 c1 client编译器(“又称c1”) ci 动态编译器的公共服务/从动态编译器到VM的接口 classfile 类文件的处理(类加载和系统符号表等等) code 动态生成的代码的管理 compiler 从VM调用动态编译器的接口 gc GC的实现 include 比较重要的头文件,就三个jvm.h/jmm.h/cds.h interpreter 解释器 jfr //todo jvmci JVM Compiler Interface libadt logging memory 内存管理 metaprogramming oops, HotSpot VM的对象系统的实现 opto C2编译器(又称optp) precompiled 预编译 prims HotSpot VM对外接口,包括部分native和JVMTI的实现 runtime 运行时支持库 service JMX utilities 工具类 ","date":"2022-05-24","objectID":"/p/2022/05/jdk-start/:3:0","tags":["jdk","java","source"],"title":"Jdk Start","uri":"/p/2022/05/jdk-start/"},{"categories":["jdk"],"content":"Tips ","date":"2022-05-24","objectID":"/p/2022/05/jdk-start/:4:0","tags":["jdk","java","source"],"title":"Jdk Start","uri":"/p/2022/05/jdk-start/"},{"categories":["jdk"],"content":"how to see JIT-compile code add ‘-XX:+UnlockDiagnosticVMOptions -XX:+PrintAssembly’ flags need disassembler.so library. wegt https://codeload.github.com/liuzhengyang/hsdis/zip/refs/heads/master unzip hsdis-master.zip tar -zxvf binutils-2.26.tar.gz cd hsdis-master make BINUTILS=binutils-2.26 ARCH=amd64 sudo cp build/linux-amd64/hsdis-amd64.so /usr/lib/jvm/java-11-openjdk/lib/ ","date":"2022-05-24","objectID":"/p/2022/05/jdk-start/:4:1","tags":["jdk","java","source"],"title":"Jdk Start","uri":"/p/2022/05/jdk-start/"},{"categories":["jdk"],"content":"Reference Building the JDK How to see JIT-compiled code in JVM? ‘man java’ command ","date":"2022-05-24","objectID":"/p/2022/05/jdk-start/:5:0","tags":["jdk","java","source"],"title":"Jdk Start","uri":"/p/2022/05/jdk-start/"},{"categories":["block chain"],"content":"Metamask recovery phrase: AES with my common password (https://tool.oschina.net/encrypt) U2FsdGVkX1808fk+twYH4WlJJ55i7GuvFTtdYE4ZfIu0tQgYIGYg1FGPeGNa+HaRZ2V6C49iaXPN2EbO5fg62o6ypDtCnK7Br5ER88zjQo1NSj8DHftGCXGQ/pIQH4Ap ","date":"2022-05-23","objectID":"/p/2022/05/block-chain/:1:0","tags":["block chain"],"title":"Block Chain","uri":"/p/2022/05/block-chain/"},{"categories":["blog"],"content":"description","date":"2022-05-10","objectID":"/p/2022/05/blog-start/","tags":["dialy","blog","hugo"],"title":"Blog Start","uri":"/p/2022/05/blog-start/"},{"categories":["blog"],"content":"Start Blog ","date":"2022-05-10","objectID":"/p/2022/05/blog-start/:0:0","tags":["dialy","blog","hugo"],"title":"Blog Start","uri":"/p/2022/05/blog-start/"},{"categories":["blog"],"content":"Create GitHub Repo ","date":"2022-05-10","objectID":"/p/2022/05/blog-start/:0:1","tags":["dialy","blog","hugo"],"title":"Blog Start","uri":"/p/2022/05/blog-start/"},{"categories":["blog"],"content":"Clone to local git clone git@github.com:ruo-xi/ruo-xi.github.io.git cd ruo-xi.github.io ","date":"2022-05-10","objectID":"/p/2022/05/blog-start/:0:2","tags":["dialy","blog","hugo"],"title":"Blog Start","uri":"/p/2022/05/blog-start/"},{"categories":["blog"],"content":"Hugo init hugo new site z mv z/* . rm -d z touch layouts/.gitkeep cp themes/FixIt/.gitignore . cp -r themes/FixIt/archetypes . cp -r themes/FixIt/exampleSite/* . ","date":"2022-05-10","objectID":"/p/2022/05/blog-start/:0:3","tags":["dialy","blog","hugo"],"title":"Blog Start","uri":"/p/2022/05/blog-start/"},{"categories":["blog"],"content":"Clone Themes git clone --depth 1 https://github.com/Lruihao/FixIt.git themes/FixIt git submodule add https://github.com/Lruihao/FixIt.git themes/FixIt git clone --depth 1 https://github.com/dillonzq/LoveIt themes/LoveIt git submodule add https://github.com/dillonzq/LoveIt themes/LoveIt update theme git submodule update --remote --merge gitalk config (comment) ","date":"2022-05-10","objectID":"/p/2022/05/blog-start/:0:4","tags":["dialy","blog","hugo"],"title":"Blog Start","uri":"/p/2022/05/blog-start/"},{"categories":["blog"],"content":"deploy GitHub create GitHub Action file touch .github/workflows/gh-pages.yml add the follow content name: github pages on: push: branches: - main # Set a branch to deploy pull_request: jobs: deploy: permissions: contents: write runs-on: ubuntu-20.04 concurrency: group: ${{ github.workflow }}-${{ github.ref }} steps: - uses: actions/checkout@v2 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: 'latest' extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 if: ${{ github.ref == 'refs/heads/main' }} with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public publish_branch: gh-pages # default: gh-pages add a branch gh-pages to GitHub repo ture you can change branch name by change the publish_branch in the next step Push git push ","date":"2022-05-10","objectID":"/p/2022/05/blog-start/:0:5","tags":["dialy","blog","hugo"],"title":"Blog Start","uri":"/p/2022/05/blog-start/"},{"categories":["blog"],"content":"Reference FixIt hugo GitHub Pages GitHub Action GitHub Actions for Hugo GitHub Pages action ","date":"2022-05-10","objectID":"/p/2022/05/blog-start/:0:6","tags":["dialy","blog","hugo"],"title":"Blog Start","uri":"/p/2022/05/blog-start/"},{"categories":null,"content":"offline cache page of FixIt theme","date":"0001-01-01","objectID":"/offline/","tags":null,"title":"","uri":"/offline/"},{"categories":null,"content":"Friends tempalate demo of FixIt theme","date":"0001-01-01","objectID":"/friends/","tags":null,"title":"Friends","uri":"/friends/"},{"categories":null,"content":" You could add your FixIt site to this page via making a PR . (e.g. #111)  Website failure, stop maintenance and improper content may be unlinked! ","date":"0001-01-01","objectID":"/friends/:0:0","tags":null,"title":"Friends","uri":"/friends/"}]